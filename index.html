<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulado AMRIGS</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0e1a2b;
      color: #ffffff;
    }

    main {
      max-width: 800px;
      margin: auto;
      background: #16273e;
      padding: 30px;
      border-radius: 10px;
      margin-top: 40px;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
      position: relative;
    }

    nav {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .btn {
      background-color: #1f3b5b;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn:hover {
      background-color: #29527a;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    .option-label {
      display: block;
      background: #1b2c47;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .option-label:hover {
      background: #244063;
    }

    .correct {
      background: #225c2e !important;
    }

    .wrong {
      background: #762c2c !important;
    }

    #flag-icon {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
    }

    .flagged {
      color: yellow;
    }

    #show-flagged {
      position: fixed;
      top: 50px;
      right: 20px;
      z-index: 1001;
      background-color: #f5a623;
      color: black;
    }

    #results {
      display: none;
      padding: 20px;
      background: #1b2c47;
      border-radius: 10px;
      max-width: 900px;
      margin: auto;
      margin-top: 40px;
    }

    details {
      margin-bottom: 15px;
    }

    summary {
      font-weight: bold;
    }

    .filters {
      margin-bottom: 15px;
    }

    .filters button {
      margin-right: 10px;
    }

    #flag-sidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 300px;
      height: 100vh;
      background: #1b2c47;
      color: white;
      padding: 20px;
      overflow-y: auto;
      transition: right 0.3s ease;
      z-index: 1000;
      box-shadow: -2px 0 10px rgba(0,0,0,0.6);
    }

    #flag-sidebar.show {
      right: 0;
    }

    #flag-sidebar h3 {
      margin-top: 0;
    }

    .flagged-question {
      margin-bottom: 20px;
      cursor: pointer;
      border-bottom: 1px solid #444;
      padding-bottom: 10px;
    }

    .flagged-question:hover {
      background-color: #244063;
    }
  </style>
</head>
<body>

  <main>
    <div id="flag-icon">⚑</div>
    <h2 id="area-title"></h2>
    <p id="question-text"></p>
    <ul id="options"></ul>
    <p id="feedback"></p>
    <nav>
      <button class="btn" id="prev">Anterior</button>
      <button class="btn" id="next">Próxima</button>
    </nav>
  </main>

  <button class="btn" id="show-flagged">Marcadas</button>

  <div id="flag-sidebar">
    <h3>Questões Marcadas</h3>
    <button class="btn" onclick="toggleFlagSidebar()">Fechar</button>
    <div id="flagged-list"></div>
  </div>

  <div id="results">
    <h2>Resultado</h2>
    <p id="score"></p>
    <div class="filters">
      <button class="btn" onclick="showFilteredQuestions('all')">Todas as Perguntas</button>
      <button class="btn" onclick="showFilteredQuestions('correct')">Corretas</button>
      <button class="btn" onclick="showFilteredQuestions('incorrect')">Incorretas</button>
    </div>
    <div id="explanations"></div>
  </div>
  <script>
    let idx = 0;
    let score = 0;
    const flagged = new Set();

    const questions = [
      {
        numero: 1,
        area: "Clínica Médica",
        question: "Qual é a principal causa de demência em idosos?",
        options: { A: "Alzheimer", B: "Demência vascular", C: "Corpos de Lewy", D: "Depressão" },
        correct: "A",
        explanation: "A Doença de Alzheimer é a causa mais comum de demência em idosos.",
      },
      {
        numero: 2,
        area: "Pediatria",
        question: "Qual a conduta inicial em uma criança com suspeita de meningite bacteriana?",
        options: { A: "Punção lombar", B: "Antibiótico imediato", C: "Exame de urina", D: "Tomografia de crânio" },
        correct: "B",
        explanation: "O antibiótico empírico deve ser iniciado imediatamente em suspeitas de meningite.",
      }
    ];

    function init() {
      showQuestion();
      document.getElementById('next').onclick = () => navigate(1);
      document.getElementById('prev').onclick = () => navigate(-1);
      document.getElementById('flag-icon').onclick = toggleFlagIcon;
      document.getElementById('show-flagged').onclick = showFlaggedQuestions;
    }

    function showQuestion() {
      const q = questions[idx];
      document.getElementById('area-title').textContent = q.area;
      document.getElementById('question-text').textContent = `${q.numero}. ${q.question}`;

      const opts = document.getElementById('options');
      opts.innerHTML = '';

      for (const key in q.options) {
        const li = document.createElement('li');
        const label = document.createElement('label');
        label.className = 'option-label';

        if (q.answered) {
          if (key === q.correct) label.classList.add('correct');
          else if (key === q.answered) label.classList.add('wrong');
        }

        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'option';
        input.disabled = !!q.answered;
        input.checked = q.answered === key;
        input.onclick = () => selectAnswer(key);

        const span = document.createElement('span');
        span.textContent = `${key}) ${q.options[key]}`;

        label.appendChild(input);
        label.appendChild(span);
        li.appendChild(label);
        opts.appendChild(li);
      }

      const feedback = document.getElementById('feedback');
      if (q.answered) {
        feedback.textContent = q.answered === q.correct
          ? 'Resposta correta!'
          : `Errado. A resposta correta é: ${q.correct}) ${q.options[q.correct]}`;
        feedback.style.color = q.answered === q.correct ? 'lightgreen' : 'tomato';
      } else {
        feedback.textContent = '';
      }

      updateButtons();
      updateFlagButton();
    }

    function selectAnswer(choice) {
      const q = questions[idx];
      if (!q.answered) {
        q.answered = choice;
        if (choice === q.correct) score++;
      }
      showQuestion();
    }

    function navigate(step) {
      idx += step;
      if (idx < 0) idx = 0;
      if (idx >= questions.length) {
        showResults();
        return;
      }
      showQuestion();
    }

    function toggleFlagIcon() {
      flagged.has(idx) ? flagged.delete(idx) : flagged.add(idx);
      updateFlagButton();
    }

    function updateButtons() {
      document.getElementById('prev').disabled = idx === 0;
      document.getElementById('next').textContent = idx === questions.length - 1 ? 'Finalizar' : 'Próxima';
    }

    function updateFlagButton() {
      const icon = document.getElementById('flag-icon');
      icon.classList.remove('flagged');
      icon.textContent = flagged.has(idx) ? '✔️' : '⚑';
      if (flagged.has(idx)) icon.classList.add('flagged');
    }

    function showFlaggedQuestions() {
      if (flagged.size === 0) {
        alert('Nenhuma questão foi marcada ainda.');
        return;
      }

      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100vw';
      modal.style.height = '100vh';
      modal.style.background = 'rgba(0,0,0,0.7)';
      modal.style.display = 'flex';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.style.zIndex = 1000;

      const content = document.createElement('div');
      content.style.background = '#1b2c47';
      content.style.padding = '20px';
      content.style.borderRadius = '10px';
      content.style.color = '#fff';
      content.style.maxHeight = '90vh';
      content.style.overflowY = 'auto';

      const close = document.createElement('button');
      close.textContent = 'Fechar';
      close.className = 'btn';
      close.onclick = () => document.body.removeChild(modal);

      content.appendChild(close);
      flagged.forEach(i => {
        const q = questions[i];
        const div = document.createElement('div');
        div.innerHTML = `<h3>${q.numero}. ${q.area}</h3><p>${q.question}</p>`;
        const go = document.createElement('button');
        go.textContent = 'Ir para esta questão';
        go.className = 'btn';
        go.onclick = () => {
          idx = i;
          document.body.removeChild(modal);
          showQuestion();
        };
        div.appendChild(go);
        content.appendChild(div);
      });

      modal.appendChild(content);
      document.body.appendChild(modal);
    }

    function showResults() {
      document.querySelector('main').style.display = 'none';
      document.querySelector('nav').style.display = 'none';

      const results = document.getElementById('results');
      results.style.display = 'block';

      const pct = Math.round((score / questions.length) * 100);
      document.getElementById('score').textContent = `Você acertou ${score} de ${questions.length} questões (${pct}%).`;

      showFilteredQuestions('all');
    }

    function showFilteredQuestions(filter) {
  const ex = document.getElementById('explanations');
  ex.innerHTML = '';

  questions.forEach((q, i) => {
    const acertou = q.answered === q.correct;
    const foiMarcada = flagged.has(i);

    if (
      (filter === 'correct' && !acertou) ||
      (filter === 'incorrect' && acertou)
    ) return;

    const div = document.createElement('div');

    const marcadaTexto = foiMarcada
      ? `<br><span style="color: yellow;">⚑ Questão marcada</span>`
      : '';

    div.innerHTML =
      `<details>
        <summary style="color:${acertou ? 'lightgreen' : 'tomato'};">
          ${q.numero}. ${acertou ? 'Correta' : 'Errada'}
          <br><span style="color: white;">Sua resposta: ${q.answered ? `${q.answered}) ${q.options[q.answered]}` : '-'}</span>
          <br>Correta: ${q.correct}) ${q.options[q.correct]}
          ${marcadaTexto}
        </summary>
        <p style="margin-left:15px;">Explicação: ${q.explanation}</p>
      </details>`;
    ex.appendChild(div);
  });

    }

    init();
  </script>
</body>
</html>
